<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>爆分攻略落地頁</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      background:#000;
      color:#fff;
      min-height:100vh;
      padding-bottom:120px; /* 預留底部按鈕空間 */
      font-family:-apple-system, BlinkMacSystemFont, "SF Pro Text","Segoe UI", system-ui, sans-serif;
    }
    .page {
      width:100%;
      max-width:520px;
      margin:0 auto;
    }
    .page img.main-bg {
      width:100%;
      height:auto;
      display:block;
    }

    /* 輪播區塊 */
    .carousel-wrapper {
      width:100%;
      margin:0 auto 8px auto;
      position:relative;
      overflow:hidden;
      border-radius:12px;
    }
    .carousel-inner {
      display:flex;
      width:100%;
      transition:transform 0.4s ease;
    }
    .carousel-slide {
      min-width:100%;
      flex-shrink:0;
      position:relative;
    }
    .carousel-slide img {
      width:100%;
      height:auto;
      display:block;
    }
    .carousel-dots {
      position:absolute;
      left:50%;
      bottom:6px;
      transform:translateX(-50%);
      display:flex;
      gap:4px;
      z-index:5;
    }
    .carousel-dot {
      width:6px;
      height:6px;
      border-radius:50%;
      background:rgba(255,255,255,0.4);
    }
    .carousel-dot.active {
      background:#fff;
    }

    /* 底部固定按鈕 */
    .fixed-btn {
      position:fixed;
      left:50%;
      bottom:16px;
      transform:translateX(-50%);
      z-index:9999;
      text-decoration:none;
      animation: breathing 2.5s ease-in-out infinite;
      transition: transform 0.15s ease, filter 0.15s ease;
    }
    .fixed-btn img {
      width:90vw;
      max-width:360px;
      height:auto;
      display:block;
    }
    @keyframes breathing {
      0% { transform:translateX(-50%) scale(1); }
      50% { transform:translateX(-50%) scale(1.08); }
      100% { transform:translateX(-50%) scale(1); }
    }
    .fixed-btn:active {
      transform:translateX(-50%) scale(0.92);
      filter:brightness(1.2);
      animation:none;
    }
  </style>
</head>
<body>
  <div class="page">
    <!-- 置頂輪播圖 -->
    <div id="banner-carousel" class="carousel-wrapper">
      <div id="carousel-inner" class="carousel-inner"></div>
      <div id="carousel-dots" class="carousel-dots"></div>
    </div>

    <!-- 原本的長背景圖 -->
    <img src="img/bg.png" alt="爆分攻略落地頁" class="main-bg">
  </div>

  <!-- 固定在螢幕下緣的呼吸按鈕 -->
  <a href="https://fbads88.gm89.net/login?id=register" class="fixed-btn">
    <img src="img/button.png" alt="領取爆分攻略">
  </a>

  <script>
    (function() {
      const REGISTER_URL = "https://fbads88.gm89.net/login?id=register";
      const MAX_BANNERS = 20;          // 最多嘗試掃描 20 張
      const PREFIX = "bn/";            // 圖片資料夾
      const carouselWrapper = document.getElementById("banner-carousel");
      const inner = document.getElementById("carousel-inner");
      const dotsWrap = document.getElementById("carousel-dots");

      let banners = [];
      let pending = 0;
      let currentIndex = 0;
      let autoTimer = null;
      let touchStartX = null;
      let isSwiping = false;

      // 掃描 bn/001.png ~ bn/020.png
      function loadBanners() {
        for (let i = 1; i <= MAX_BANNERS; i++) {
          const num = String(i).padStart(3, "0");
          const src = PREFIX + num + ".png";
          pending++;
          const img = new Image();
          img.onload = function() {
            banners.push(src);
            checkDone();
          };
          img.onerror = function() {
            checkDone();
          };
          img.src = src;
        }
      }

      function checkDone() {
        pending--;
        if (pending === 0) {
          if (banners.length === 0) {
            // 沒有任何圖，直接隱藏輪播區
            carouselWrapper.style.display = "none";
          } else {
            initCarousel();
          }
        }
      }

      function initCarousel() {
        // 建立 slide
        banners.forEach(function(src, idx) {
          const slide = document.createElement("div");
          slide.className = "carousel-slide";
          const img = document.createElement("img");
          img.src = src;
          img.alt = "banner " + (idx + 1);
          slide.appendChild(img);
          inner.appendChild(slide);

          const dot = document.createElement("div");
          dot.className = "carousel-dot" + (idx === 0 ? " active" : "");
          dotsWrap.appendChild(dot);
        });

        // 點擊整個輪播區塊 -> 跳轉
        carouselWrapper.addEventListener("click", function() {
          if (!isSwiping) {
            window.location.href = REGISTER_URL;
          }
        });

        // 手機滑動切換
        carouselWrapper.addEventListener("touchstart", function(e) {
          if (e.touches && e.touches.length === 1) {
            touchStartX = e.touches[0].clientX;
            isSwiping = false;
          }
        });

        carouselWrapper.addEventListener("touchmove", function(e) {
          if (!touchStartX || !e.touches || e.touches.length !== 1) return;
          const dx = e.touches[0].clientX - touchStartX;
          if (Math.abs(dx) > 10) {
            isSwiping = true;
          }
        });

        carouselWrapper.addEventListener("touchend", function(e) {
          if (!touchStartX) return;
          const endX = (e.changedTouches && e.changedTouches[0].clientX) || touchStartX;
          const dx = endX - touchStartX;

          if (isSwiping && Math.abs(dx) > 40) {
            if (dx < 0) nextSlide();
            else prevSlide();
          } else {
            // 位移不大，當作點擊交給 click handler
          }

          touchStartX = null;
          // 重啟自動輪播
          restartAuto();
        });

        startAuto();
      }

      function updateCarousel() {
        const offset = -currentIndex * 100;
        inner.style.transform = "translateX(" + offset + "%)";
        const dots = dotsWrap.children;
        for (let i = 0; i < dots.length; i++) {
          dots[i].classList.toggle("active", i === currentIndex);
        }
      }

      function nextSlide() {
        if (banners.length <= 1) return;
        currentIndex = (currentIndex + 1) % banners.length;
        updateCarousel();
      }

      function prevSlide() {
        if (banners.length <= 1) return;
        currentIndex = (currentIndex - 1 + banners.length) % banners.length;
        updateCarousel();
      }

      function startAuto() {
        if (autoTimer) clearInterval(autoTimer);
        autoTimer = setInterval(nextSlide, 3000); // 3 秒換一張
      }

      function restartAuto() {
        if (autoTimer) {
          clearInterval(autoTimer);
        }
        autoTimer = setInterval(nextSlide, 3000);
      }

      loadBanners();
    })();
  </script>
</body>
</html>
