<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Fireworks Test v2</title>
<style>
html,body{margin:0;width:100%;height:100%;background:#000;overflow:hidden;}
canvas{position:fixed;inset:0;display:block;}
</style>
</head>
<body>
<canvas id="fw"></canvas>

<script>
const canvas = document.getElementById('fw');
const ctx = canvas.getContext('2d');
let W=0,H=0,dpr=Math.min(2,window.devicePixelRatio||1);

function resize(){
  W=window.innerWidth; H=window.innerHeight;
  canvas.width=Math.floor(W*dpr);
  canvas.height=Math.floor(H*dpr);
  ctx.setTransform(dpr,0,0,dpr,0,0);
}
resize(); addEventListener('resize',resize);

const rockets=[], sparks=[];
const colors=['#ff4d4d','#ffd166','#06c755','#4dd0ff','#b388ff','#ff7aff'];
const rand=(a,b)=>a+Math.random()*(b-a);

function launch(){
  rockets.push({
    x: rand(0,W),
    y: H + 30,
    vx: rand(-0.5,0.5),
    vy: rand(-12,-9),          // stronger lift
    g:  rand(0.06,0.10),       // lighter gravity
    explodeY: rand(H*0.01, H*0.08),
    fuse: rand(38, 62),        // GUARANTEE explode even if height calc feels off
    color: colors[(Math.random()*colors.length)|0]
  });
}

function explode(r){
  const n = (rand(55, 90))|0;
  for(let i=0;i<n;i++){
    const a = Math.random()*Math.PI*2;
    const s = rand(1.8, 4.8);
    sparks.push({
      x:r.x,y:r.y,
      vx:Math.cos(a)*s,
      vy:Math.sin(a)*s,
      g: rand(0.03,0.06),
      life: rand(55, 90),
      age: 0,
      size: rand(1.6, 3.0),
      color:r.color
    });
  }
}

function tick(){
  // trail fade
  ctx.fillStyle='rgba(0,0,0,0.22)';
  ctx.fillRect(0,0,W,H);

  // launch rate
  if(Math.random()<0.10) launch();

  // rockets
  for(let i=rockets.length-1;i>=0;i--){
    const r=rockets[i];
    r.x += r.vx;
    r.y += r.vy;
    r.vy += r.g;
    r.fuse -= 1;

    // rocket dot
    ctx.fillStyle=r.color;
    ctx.globalAlpha=0.95;
    ctx.beginPath();
    ctx.arc(r.x,r.y,2.4,0,Math.PI*2);
    ctx.fill();
    ctx.globalAlpha=1;

    if(r.fuse<=0 || r.y <= r.explodeY){
      explode(r);
      rockets.splice(i,1);
    }
  }

  // sparks
  for(let i=sparks.length-1;i>=0;i--){
    const s=sparks[i];
    s.x += s.vx;
    s.y += s.vy;
    s.vy += s.g;
    s.vx *= 0.985;
    s.vy *= 0.985;
    s.age += 1;

    const a = Math.max(0, 1 - s.age/s.life);
    ctx.globalAlpha = a;
    ctx.fillStyle = s.color;
    ctx.beginPath();
    ctx.arc(s.x,s.y,s.size,0,Math.PI*2);
    ctx.fill();
    ctx.globalAlpha = 1;

    if(s.age >= s.life || s.y>H+80 || s.x<-80 || s.x>W+80) sparks.splice(i,1);
  }

  requestAnimationFrame(tick);
}

ctx.fillStyle='#000';
ctx.fillRect(0,0,W,H);
requestAnimationFrame(tick);
</script>
</body>
</html>
